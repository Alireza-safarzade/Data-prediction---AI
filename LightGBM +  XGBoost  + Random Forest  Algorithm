# ğŸ“Œ 1. Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
!pip install lightgbm xgboost openpyxl scikit-learn optuna matplotlib seaborn --quiet

# ğŸ“Œ 2. importÙ‡Ø§
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from lightgbm import LGBMClassifier
from xgboost import XGBClassifier
from sklearn.metrics import classification_report, confusion_matrix, f1_score
from google.colab import files
import seaborn as sns
import matplotlib.pyplot as plt
import warnings
warnings.filterwarnings("ignore")

# ğŸ“Œ 3. Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„ Ø¢Ù…ÙˆØ²Ø´
print("â¬†ï¸ Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø¢Ù…ÙˆØ²Ø´ (train.xlsx) Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯:")
uploaded_train = files.upload()
train_path = list(uploaded_train.keys())[0]
df_train = pd.read_excel(train_path)

# ğŸ“Œ 4. Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡
if 'Profit' in df_train.columns:
    df_train = df_train.drop(columns=['Profit'])

X = df_train.drop(columns=["Result"])
y = df_train["Result"]
feature_columns = X.columns.tolist()

# ğŸ“Œ 5. ØªÙ‚Ø³ÛŒÙ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
X_train, X_valid, y_train, y_valid = train_test_split(X, y, test_size=0.2, random_state=42)

# ğŸ“Œ 6. ØªØ¹Ø±ÛŒÙ Ù…Ø¯Ù„â€ŒÙ‡Ø§
models = {
    "LightGBM": LGBMClassifier(random_state=42),
    "XGBoost": XGBClassifier(random_state=42, use_label_encoder=False, eval_metric='mlogloss'),
    "RandomForest": RandomForestClassifier(random_state=42)
}

# ğŸ“Œ 7. Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§
f1_scores = {}
for name, model in models.items():
    model.fit(X_train, y_train)
    preds = model.predict(X_valid)
    f1 = f1_score(y_valid, preds, average="weighted")
    f1_scores[name] = f1
    print(f"ğŸ” {name} F1-Score: {f1:.4f}")
    print(classification_report(y_valid, preds))
    print("-" * 40)

# ğŸ“Œ 8. Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø¯Ù„
best_model_name = max(f1_scores, key=f1_scores.get)
best_model = models[best_model_name]
print(f"âœ… Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø¯Ù„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡: {best_model_name}")

# ğŸ“Œ 9. Ø±Ø³Ù… Confusion Matrix Ù…Ø¯Ù„ Ù†Ù‡Ø§ÛŒÛŒ
from sklearn.metrics import ConfusionMatrixDisplay
ConfusionMatrixDisplay.from_estimator(best_model, X_valid, y_valid, display_labels=np.unique(y), cmap='Blues')
plt.title("Confusion Matrix")
plt.grid(False)
plt.show()

# ğŸ“Œ 10. Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ ØªØ³Øª
print("â¬†ï¸ Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ ØªØ³Øª (test.xlsx) Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯:")
uploaded_test = files.upload()
test_path = list(uploaded_test.keys())[0]
df_test = pd.read_excel(test_path)

# ğŸ“Œ 11. Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø±ÙˆÛŒ ÙØ§ÛŒÙ„ ØªØ³Øª
df_test_input = df_test[feature_columns]
test_preds = best_model.predict(df_test_input)
df_test["Result"] = test_preds

# ğŸ“Œ 12. Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ
output_path = "predicted_result.xlsx"
df_test.to_excel(output_path, index=False)

# ğŸ“Œ 13. Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ
files.download(output_path)
