# Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
!pip install openpyxl xgboost scikit-learn matplotlib seaborn

# 1ï¸âƒ£ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.model_selection import cross_val_score, StratifiedKFold, cross_val_predict
from sklearn.metrics import confusion_matrix, classification_report, ConfusionMatrixDisplay
from scipy.stats import f_oneway, kruskal
from xgboost import XGBClassifier
from google.colab import files

# 2ï¸âƒ£ Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„
uploaded = files.upload()
file_name = list(uploaded.keys())[0]

# 3ï¸âƒ£ Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡
df = pd.read_excel(file_name)

# 4ï¸âƒ£ ØªÙ…ÛŒØ²Ø³Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
target_col = 'Result'
df = df[df[target_col].isin([-1, 0, 1])]  # ÙÙ‚Ø· Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±
df = df.dropna()  # Ø­Ø°Ù Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù‚Øµ

# 5ï¸âƒ£ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯ Ø¨Ø§ ANOVA
X_all = df.drop(columns=[target_col])
y_all = df[target_col]

results = []
for col in X_all.columns:
    group_data = [X_all[y_all == label][col] for label in sorted(y_all.unique())]
    try:
        f_stat, p_value = f_oneway(*group_data)
        test = "ANOVA"
    except:
        f_stat, p_value = kruskal(*group_data)
        test = "Kruskal"
    results.append({"Feature": col, "Test": test, "P-value": p_value})

results_df = pd.DataFrame(results).sort_values(by="P-value")
useful_features = results_df[results_df["P-value"] < 0.05]["Feature"].tolist()

# 6ï¸âƒ£ Ø¯Ø§Ø¯Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„
X = df[useful_features]
y = df[target_col].map({-1: 0, 0: 1, 1: 2})  # Ù†Ú¯Ø§Ø´Øª Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ Ø¨Ù‡ [0, 1, 2]

# 7ï¸âƒ£ Ù…Ø¯Ù„ Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Cross-Validation
model = XGBClassifier(use_label_encoder=False, eval_metric='mlogloss', random_state=42)
cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)

# 8ï¸âƒ£ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù‚Øª Cross-Validated
scores = cross_val_score(model, X, y, cv=cv, scoring='accuracy')
print("ğŸ¯ Ø¯Ù‚Øª Ù‡Ø± Fold:", scores)
print("âœ… Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¯Ù‚Øª:", np.mean(scores).round(4))

# 9ï¸âƒ£ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø±ÙˆÛŒ Ú©Ù„ Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ Cross-Val Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ
y_pred = cross_val_predict(model, X, y, cv=cv)

# ğŸ”Ÿ Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„ Precision, Recall, F1 Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ù„Ø§Ø³
print("\nğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø¯Ù„:")
print(classification_report(y, y_pred, target_names=['Class -1 (0)', 'Class 0 (1)', 'Class +1 (2)']))

# ğŸ”„ Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø±
cm = confusion_matrix(y, y_pred)
disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=['-1', '0', '+1'])

plt.figure(figsize=(6,5))
disp.plot(cmap='Blues', values_format='d')
plt.title("ğŸ§© Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ Ù…Ø¯Ù„")
plt.show()
