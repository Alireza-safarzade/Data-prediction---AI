# ğŸ“Œ 1. Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
!pip install lightgbm xgboost openpyxl scikit-learn matplotlib seaborn --quiet
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 2. importÙ‡Ø§
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier, VotingClassifier
from lightgbm import LGBMClassifier
from xgboost import XGBClassifier
from sklearn.metrics import classification_report, confusion_matrix
from sklearn.metrics import ConfusionMatrixDisplay
from google.colab import files
import matplotlib.pyplot as plt
import seaborn as sns
import warnings
warnings.filterwarnings("ignore")
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 3. Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„ Ø¢Ù…ÙˆØ²Ø´
print("â¬†ï¸ Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø¢Ù…ÙˆØ²Ø´ (train.xlsx) Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯:")
uploaded_train = files.upload()
train_path = list(uploaded_train.keys())[0]
df_train = pd.read_excel(train_path)
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 4. Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡
if 'Profit' in df_train.columns:
    df_train.drop(columns=['Profit'], inplace=True)

X = df_train.drop(columns=['Result'])
y = df_train['Result']
feature_columns = X.columns.tolist()
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 5. ØªÙ‚Ø³ÛŒÙ… Ø¢Ù…ÙˆØ²Ø´ / Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
X_train, X_valid, y_train, y_valid = train_test_split(X, y, test_size=0.2, random_state=42)
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 6. ØªØ¹Ø±ÛŒÙ Ù…Ø¯Ù„â€ŒÙ‡Ø§
model_lgb = LGBMClassifier(random_state=42)
model_xgb = XGBClassifier(random_state=42, use_label_encoder=False, eval_metric='mlogloss')
model_rf = RandomForestClassifier(random_state=42)
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 7. ØªØ±Ú©ÛŒØ¨ Ù…Ø¯Ù„â€ŒÙ‡Ø§ Ø¨Ø§ Voting
ensemble_model = VotingClassifier(
    estimators=[
        ('lgb', model_lgb),
        ('xgb', model_xgb),
        ('rf', model_rf)
    ],
    voting='hard'  # ÛŒØ§ 'soft' Ø¨Ø±Ø§ÛŒ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª
)
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 8. Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¯Ù„ ØªØ±Ú©ÛŒØ¨ÛŒ
ensemble_model.fit(X_train, y_train)
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 9. Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø¯Ù„ ØªØ±Ú©ÛŒØ¨ÛŒ
valid_preds = ensemble_model.predict(X_valid)
print("âœ… Ú¯Ø²Ø§Ø±Ø´ Ø·Ø¨Ù‚Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø¯Ù„ ØªØ±Ú©ÛŒØ¨ÛŒ:")
print(classification_report(y_valid, valid_preds))
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 10. Ù…Ø§ØªØ±ÛŒØ³ Ø³Ø±Ø¯Ø±Ú¯Ù…ÛŒ
ConfusionMatrixDisplay.from_estimator(ensemble_model, X_valid, y_valid, display_labels=np.unique(y), cmap='Blues')
plt.title("Confusion Matrix - Voting Ensemble")
plt.grid(False)
plt.show()
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 11. Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„ ØªØ³Øª
print("â¬†ï¸ Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ ØªØ³Øª (test.xlsx) Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯:")
uploaded_test = files.upload()
test_path = list(uploaded_test.keys())[0]
df_test = pd.read_excel(test_path)
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 12. Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø±ÙˆÛŒ ÙØ§ÛŒÙ„ ØªØ³Øª
df_test_input = df_test[feature_columns]
test_preds = ensemble_model.predict(df_test_input)
df_test['Result'] = test_preds
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 13. Ø°Ø®ÛŒØ±Ù‡ Ø®Ø±ÙˆØ¬ÛŒ
output_path = "predicted_result_ensemble.xlsx"
df_test.to_excel(output_path, index=False)
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
# ğŸ“Œ 14. Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ù†Ù‡Ø§ÛŒÛŒ
files.download(output_path)
#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
